## OAuth2 Proxy Configuration for Supabase

# Provider configuration
provider = "oidc"
oidc_issuer_url = "{{ supabase_url }}/auth/v1"
client_id = "{{ supabase_publishable_key }}"
code_challenge_method = "S256"
redirect_url = "https://{{ api_domain }}/oauth2/callback"

# Cookie configuration
cookie_name = "_oauth2_proxy"
cookie_secret = "{{ oauth2_proxy_cookie_secret }}"
cookie_domains = [".cyanlab.cc"]
cookie_secure = true
cookie_httponly = true
cookie_samesite = "lax"

# Session configuration
cookie_expire = "168h"  # 7 days
cookie_refresh = "1h"

# Email and domains
email_domains = ["*"]
whitelist_domains = [".cyanlab.cc"]

# Upstream configuration
upstreams = ["http://{{ api_backend_host }}:{{ api_backend_port }}"]
http_address = "127.0.0.1:{{ oauth2_proxy_port }}"

# Header configuration
pass_user_headers = true
pass_access_token = true
pass_authorization_header = true
set_xauthrequest = true
set_authorization_header = true

# Logging
request_logging = true
auth_logging = true
standard_logging = true

# Skip authentication for public endpoints
skip_auth_routes = [
  "^/health$",
  "^/api/v0/datadragon/"
]
